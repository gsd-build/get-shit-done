# Исходное состояние проекта (до доработки)

> Описание того, что было передано разработчиком. Зафиксировано на основе коммита `262e803` от 17.02.2026.

---

## Файлы, переданные разработчиком

| Файл | Тип | Описание |
|------|-----|----------|
| `bot_with_check_updated.py` | Python | Основной код Telegram-бота (660 строк) |
| `import_codes.py` | Python | Скрипт загрузки кодов ТН ВЭД из PDF в SQLite (152 строки) |
| `ru.84_2022_21.09.2025.pdf` | PDF | Решение Совета ЕЭК от 14.09.2021 № 80 (ТН ВЭД ЕАЭС), редакция 21.09.2025 (~2.3 МБ) |
| `Алгоритм.pdf` | PDF | Блок-схема алгоритма работы бота (~240 КБ) |
| `Анализ_правовых_рисков_и_логистических_факторов_в_классификации.docx` | DOCX | Анализ правовых рисков при классификации товаров по ТН ВЭД (~36 КБ) |
| `ТЗ 2.0.docx` | DOCX | Техническое задание на создание бота (~38 КБ) |
| `презентация по проекту.md` | Markdown | Презентация команды: цели, критерии MVP, статус работ |
| `Podbor_NPA.md` | Markdown | Таблица применимых НПА (16 документов с описаниями) |
| `New Text Document.txt` | TXT | Пустой файл (артефакт) |

---

## Состояние кода на момент передачи

### Что работало

- Базовая структура бота на **aiogram 3** с FSM-состояниями
- Команды: `/start`, `/help`, `/mode`, `/classify`, `/check`, `/suggest`, `/analysis`, `/history`, `/cancel`
- Два режима: Light (6 состояний FSM) и Expert (fallback-обработчик)
- SQLite БД с тремя таблицами: `users`, `queries`, `tnved`
- Поиск кандидатов по ключевым словам (`tnved_search_candidates`)
- Парсинг PDF с кодами ТН ВЭД (`import_codes.py`)

### Критические проблемы безопасности

- **Токен захардкожен в коде:** `BOT_TOKEN = "8338103787:AAEjqWfbQHgjOGLtl4SmFSvPEkmCciX9yyc"` — попадал в git-историю
- Нет `.gitignore` для секретов и локальных данных
- Нет `requirements.txt` — зависимости не задокументированы

### Нерабочий функционал

| Проблема | Детали |
|----------|--------|
| OpenAI-интеграция не работала | Вызов `client.responses.create()` с параметром `reasoning={"effort": "none"}`, несовместимым с gpt-5.2. Бот падал при наличии `OPENAI_API_KEY` |
| Light-режим дублировал `/check` | Первый шаг опросника спрашивал «Знаете код?» и при ответе «Да» просто проверял код — то же самое, что `/check` |
| Expert-режим не отличал «мало данных» | Любой текст (в том числе «холодильник») сразу шёл в классификатор без проверки полноты описания |
| Ограничение 8408/8418 | Классификатор, команда `/check` и `import_codes.py` работали только с двумя группами товаров |
| `ANALYSIS_TEXT` — заглушка | Текст содержал `"... (сокращено) ..."` вместо реального содержания |
| Нет логирования | Все события поглощались молча; ошибки не фиксировались |

### Незакрытые задачи разработчика (из презентации)

1. Встроить в бота нейронку (ChatGPT)
2. Сделать режим Light в формате диалога (тогда он выполнял функцию `/check`)
3. Режим Expert — добавить проверку достаточности данных и предложение перейти в Light
4. Разработать критерии достаточности описания в Expert-режиме

---

## Итоговая оценка

Проект находился в состоянии **работающего скелета**: структура и архитектура корректные, но ключевой функционал (LLM, диалоговый Light, фильтрация Expert) либо не реализован, либо сломан. Запустить бот безопасно было невозможно из-за захардкоженного токена.
