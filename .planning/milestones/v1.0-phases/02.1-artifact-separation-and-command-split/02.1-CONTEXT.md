# Phase 02.1: Artifact Separation and Command Split - Context

**Gathered:** 2026-02-16
**Status:** Ready for planning

<domain>
## Phase Boundary

Restructure Declare's artifact layer so milestones and actions are cleanly separated. MILESTONES.md becomes milestones-only, each milestone gets its own folder with a PLAN.md (actions = the plan), and commands are split to match. This phase also introduces basic staleness detection in /declare:status. The key philosophical shift: FUTURE.md + MILESTONES.md is a **living document** — always an accurate snapshot of the project, not archaeological layers. When declarations change, milestones reconcile rather than being archived as "past phases."

</domain>

<decisions>
## Implementation Decisions

### Folder structure
- Milestone folders live in `.planning/milestones/`
- Naming convention: ID + slug (e.g., `M001-user-auth/`)
- Each folder contains PLAN.md (the actions/plan for that milestone) plus execution artifacts (summaries, logs generated during execution)
- MILESTONES.md (flat file) and folders are dual-maintained: MILESTONES.md holds milestone metadata (status, cross-refs), folders hold plan and execution artifacts. Both are authoritative for their respective concerns.

### Migration path
- No production data to migrate — still in dev/testing
- Fresh start: strip actions from MILESTONES.md, keep existing milestones
- Actions will be re-derived through /declare:actions into the new folder structure
- Old test data can be discarded

### Command behavior: /declare:milestones
- Derives milestones **per declaration** (one declaration at a time → derive → confirm → next)
- Confirmation uses AskUserQuestion multi-select checkboxes — user checks which milestones to accept
- Only derives milestones, no actions (actions are /declare:actions)

### Command behavior: /declare:actions
- Two modes: `/declare:actions` (no args) = derive plans for all milestones missing one (happy path); `/declare:actions M001` = target a specific milestone
- Presents derived plan for approval before writing PLAN.md to the milestone folder
- Creates the milestone folder if it doesn't exist yet

### Living sync model (partial)
- When a declaration changes, /declare:milestones flags inconsistencies with existing milestones — user decides what to update (not automatic reconciliation)
- When a milestone is removed, its folder is archived to `.planning/milestones/_archived/`
- /declare:status enhanced with basic health view: milestone coverage, plan status, staleness indicators
- Full sync logic (automatic reconciliation, drift detection) deferred to later phases

### Claude's Discretion
- PLAN.md format inside milestone folders
- Exact staleness detection heuristics for /declare:status
- How inconsistency flagging presents to the user
- Internal data structures for cross-reference tracking

</decisions>

<specifics>
## Specific Ideas

- Milestones are the unit of work — "deliver all milestones, the future is realized"
- The structure serves as a living requirements list, always accurate, never archived
- FUTURE.md + MILESTONES.md together = the complete picture of what this project is and needs
- When new declarations arise, only check consistency and create/update milestones — no "phase insertion" needed
- Web UI is coming (future phase) — the structure should be UI-friendly

</specifics>

<deferred>
## Deferred Ideas

- Rich web UI for browsing/editing the declaration → milestone → action structure — future phase
- Full automatic reconciliation when declarations change — later phase (this phase builds structure that enables it)
- Drift detection (actions with no causation path) — Phase 6

</deferred>

---

*Phase: 02.1-artifact-separation-and-command-split*
*Context gathered: 2026-02-16*
