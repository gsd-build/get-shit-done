---
phase: 02.1-artifact-separation-and-command-split
plan: 01
subsystem: artifacts
tags: [markdown-parser, cjs-modules, milestone-folders, plan-format]

requires:
  - phase: 02-future-declaration-backward-derivation
    provides: milestones.js, future.js, load-graph.js, engine.js
provides:
  - plan.js PLAN.md parser/writer for milestone folders
  - milestone-folders.js folder CRUD utilities
  - milestones.js rewritten for milestones-only format (no actions)
  - load-graph.js scans milestone folders for actions
affects: [02.1-02-commands, 02.1-03-slash-commands]

tech-stack:
  added: []
  patterns: [section-per-action PLAN.md format, milestone folder convention M-XX-slug]

key-files:
  created:
    - src/artifacts/plan.js
    - src/artifacts/milestone-folders.js
  modified:
    - src/artifacts/milestones.js
    - src/commands/load-graph.js
    - src/commands/add-milestone.js
    - src/commands/add-action.js
    - src/artifacts/artifacts.test.js
    - src/commands/commands.test.js

key-decisions:
  - "Folder naming uses M-XX-slug (matching DAG ID format) not M001-slug"
  - "writeMilestonesFile backward compat bridge: accepts 2 or 3 args"
  - "add-action deprecated immediately (returns error with create-plan suggestion)"
  - "Milestones have hasPlan boolean instead of causedBy array"

patterns-established:
  - "PLAN.md format: section-per-action with ### A-XX headers, **Status/Produces** fields"
  - "Milestone folder convention: .planning/milestones/{M-XX-slug}/PLAN.md"
  - "load-graph scans three sources: FUTURE.md + MILESTONES.md + milestone folders"

duration: 4min
completed: 2026-02-16
---

# Plan 02.1-01: Artifact Layer Summary

**Milestones-only MILESTONES.md, per-milestone PLAN.md parser/writer, folder utilities, and folder-scanning load-graph**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-16
- **Completed:** 2026-02-16
- **Tasks:** 2
- **Files modified:** 8

## Accomplishments
- Created plan.js with parsePlanFile/writePlanFile for section-per-action PLAN.md format
- Created milestone-folders.js with 6 folder utilities (slugify, create, find, archive)
- Rewrote milestones.js to return milestones-only with hasPlan field
- Updated load-graph.js to scan .planning/milestones/*/PLAN.md for actions
- 48 tests passing (31 artifact + 17 command)

## Task Commits

1. **Task 1: Create plan.js and milestone-folders.js with tests** - `fcd0eb5` (feat)
2. **Task 2: Rewrite milestones.js and load-graph.js** - `5b0c3c0` (feat)

## Files Created/Modified
- `src/artifacts/plan.js` - PLAN.md parser and writer for milestone folders
- `src/artifacts/milestone-folders.js` - Folder CRUD utilities (slugify, create, find, archive)
- `src/artifacts/milestones.js` - Rewritten: milestones-only, hasPlan field, backward compat bridge
- `src/commands/load-graph.js` - Scans FUTURE.md + MILESTONES.md + milestone folder PLAN.md files
- `src/commands/add-milestone.js` - Updated for new milestones format (no actions)
- `src/commands/add-action.js` - Deprecated with create-plan suggestion
- `src/artifacts/artifacts.test.js` - 31 tests covering all new and updated modules
- `src/commands/commands.test.js` - 17 tests updated for new format

## Decisions Made
- Used M-XX-slug folder naming (matches DAG ID format, avoids conversion layer)
- Added backward compat bridge to writeMilestonesFile for gradual caller migration
- Deprecated add-action immediately rather than keeping broken compatibility

## Deviations from Plan
None - plan executed as specified.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Artifact layer complete, ready for Plan 02 (CLI subcommands) and Plan 03 (slash commands)
- Backward compat bridge enables gradual migration of callers

---
*Phase: 02.1-artifact-separation-and-command-split*
*Completed: 2026-02-16*
