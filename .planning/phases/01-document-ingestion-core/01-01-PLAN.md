---
phase: 01-document-ingestion-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/gsd-doc-ingestor.md
autonomous: true

must_haves:
  truths:
    - "gsd-doc-ingestor agent can be spawned by map-codebase workflow"
    - "Agent reads files from provided paths"
    - "Agent writes USER-CONTEXT.md to .planning/codebase/"
    - "Agent returns confirmation only (not full content)"
  artifacts:
    - path: "agents/gsd-doc-ingestor.md"
      provides: "Document ingestor agent definition"
      min_lines: 150
      contains: "gsd-doc-ingestor"
  key_links:
    - from: "agents/gsd-doc-ingestor.md"
      to: ".planning/codebase/USER-CONTEXT.md"
      via: "Write tool usage"
      pattern: "Write.*USER-CONTEXT"
---

<objective>
Create the gsd-doc-ingestor agent that processes user-provided documentation paths and writes USER-CONTEXT.md.

Purpose: This agent handles the actual document ingestion work, keeping context out of the orchestrator workflow. It follows the established gsd-codebase-mapper pattern.

Output: New agent file at `agents/gsd-doc-ingestor.md` that can be spawned by the map-codebase workflow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-document-ingestion-core/01-CONTEXT.md
@.planning/phases/01-document-ingestion-core/01-RESEARCH.md

# Pattern to follow
@agents/gsd-codebase-mapper.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gsd-doc-ingestor agent</name>
  <files>agents/gsd-doc-ingestor.md</files>
  <action>
Create a new agent file following the gsd-codebase-mapper pattern. The agent should:

**Frontmatter:**
- name: gsd-doc-ingestor
- description: Ingests user-provided documentation into USER-CONTEXT.md. Spawned by map-codebase workflow.
- tools: Read, Write, Bash, Glob, Grep, AskUserQuestion
- color: cyan

**Role section:**
- Spawned by `/gsd:map-codebase` when user provides documentation paths
- Receives list of file/directory paths to process
- Writes `.planning/codebase/USER-CONTEXT.md` directly
- Returns confirmation only (not full content) to preserve orchestrator context

**Process steps:**

1. `check_existing` - Check if USER-CONTEXT.md already exists
   - If exists: Use AskUserQuestion to ask "Replace or merge?"
   - If replace: Will overwrite
   - If merge: Will append new docs to existing

2. `validate_paths` - Validate each provided path
   - Use `test -e` for existence
   - Use `test -d` for directory detection
   - Invalid paths: Log and continue (orchestrator already asked user about invalid paths)

3. `process_directories` - For directory paths, scan for relevant docs
   - Use Glob to find files: `**/*.md`, `**/*.txt`, `**/README*`, `**/CHANGELOG*`
   - Read first 100 lines of each potential file
   - Determine if it's documentation (not code)
   - If looks like code: Use AskUserQuestion - "This looks like code. Include as documentation?"

4. `read_and_categorize` - Read each file and categorize
   - Categories: architecture, api, general, setup, reference
   - Use keyword analysis and content structure to detect category
   - Store: path, content, category, file size, ingestion date

5. `write_user_context` - Write USER-CONTEXT.md
   - Header with metadata (ingestion date, document count)
   - Group documents by category
   - Each document section includes:
     - Source path
     - File size
     - Ingestion date
     - Category
     - Content (verbatim for small files, potentially summarized for large)
   - "Large file" threshold: 10KB (Claude's discretion per CONTEXT.md)

6. `return_confirmation` - Return brief confirmation only
   - Format: "## INGESTION COMPLETE\n\n**Documents processed:** N\n**Output:** `.planning/codebase/USER-CONTEXT.md`\n**Categories:** [list]\n\nReady for codebase mapping."

**Template for USER-CONTEXT.md:**
```markdown
# User-Provided Documentation

**Ingested:** [YYYY-MM-DD]
**Documents:** [N] files from [M] paths

## [Category Name]

### [document-name.md]
**Source:** `[original path]`
**Size:** [X.X KB]
**Ingested:** [YYYY-MM-DD]

[Content here - verbatim or summarized]

---

## [Next Category]
...
```

**Critical rules (from gsd-codebase-mapper pattern):**
- WRITE DOCUMENTS DIRECTLY - do not return content to orchestrator
- RETURN ONLY CONFIRMATION - response should be ~10 lines max
- DO NOT COMMIT - orchestrator handles git operations
  </action>
  <verify>
```bash
test -f agents/gsd-doc-ingestor.md && wc -l agents/gsd-doc-ingestor.md
```
File exists and has 150+ lines.
  </verify>
  <done>
- Agent file exists at agents/gsd-doc-ingestor.md
- Follows gsd-codebase-mapper structure (frontmatter, role, process, templates, critical_rules, success_criteria)
- Includes USER-CONTEXT.md template
- Returns confirmation format documented
  </done>
</task>

</tasks>

<verification>
1. File exists: `test -f agents/gsd-doc-ingestor.md`
2. Has required sections: grep for `<role>`, `<process>`, `<templates>`, `<critical_rules>`
3. References correct output path: grep for `USER-CONTEXT.md`
4. Uses correct tools: Check frontmatter lists Read, Write, Bash, Glob, Grep, AskUserQuestion
</verification>

<success_criteria>
- [ ] agents/gsd-doc-ingestor.md exists with 150+ lines
- [ ] Agent follows gsd-codebase-mapper structural pattern
- [ ] Process steps cover: check_existing, validate_paths, process_directories, read_and_categorize, write_user_context, return_confirmation
- [ ] USER-CONTEXT.md template included with category structure
- [ ] Confirmation format documented (brief, counts only)
</success_criteria>

<output>
After completion, create `.planning/phases/01-document-ingestion-core/01-01-SUMMARY.md`
</output>
