---
phase: 02-document-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/gsd-doc-validator.md
autonomous: true

must_haves:
  truths:
    - "Validator agent can extract verifiable technical claims from USER-CONTEXT.md"
    - "Each claim receives a confidence score (HIGH/MEDIUM/LOW)"
    - "LOW confidence claims are presented to user for decision"
    - "User choices (Include/Exclude/Mark stale) are collected"
    - "USER-CONTEXT.md is updated with validation status"
  artifacts:
    - path: "agents/gsd-doc-validator.md"
      provides: "Document validation agent definition"
      min_lines: 250
      exports: []
  key_links:
    - from: "gsd-doc-validator.md"
      to: "USER-CONTEXT.md"
      via: "Read tool"
      pattern: "Read.*USER-CONTEXT"
    - from: "gsd-doc-validator.md"
      to: "codebase files"
      via: "Bash/Grep verification"
      pattern: "test -f|grep"
---

<objective>
Create the gsd-doc-validator agent that validates user-provided documentation claims against the actual codebase.

Purpose: This agent is the core of Phase 2 - it extracts verifiable technical claims from USER-CONTEXT.md, verifies each claim against real code, assigns confidence levels, presents issues to users, and updates the documentation with validation status.

Output: `agents/gsd-doc-validator.md` - A complete agent definition following gsd-verifier patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-document-validation/02-CONTEXT.md
@.planning/phases/02-document-validation/02-RESEARCH.md
@agents/gsd-verifier.md
@agents/gsd-doc-ingestor.md
@get-shit-done/references/verification-patterns.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gsd-doc-validator agent</name>
  <files>agents/gsd-doc-validator.md</files>
  <action>
Create the gsd-doc-validator agent following the structure established by gsd-verifier and gsd-doc-ingestor.

**Agent structure:**
```yaml
---
name: gsd-doc-validator
description: Validates user-provided documentation claims against actual codebase. Spawned by map-codebase workflow after doc ingestion.
tools: Read, Write, Bash, Grep, Glob, AskUserQuestion
color: yellow
---
```

**Implement the 7-step process from RESEARCH.md:**

1. **load_documents** - Read USER-CONTEXT.md from `.planning/codebase/`
   - Parse the document structure (categories, source paths)
   - Track document metadata for later annotation

2. **extract_claims** - Parse verifiable technical claims
   - Extract file path claims (backticked paths like `src/config/index.ts`)
   - Extract function/class claims (backticked identifiers)
   - Extract export claims (`exports X`, `default exports`)
   - Extract directory structure claims
   - Extract API signature claims (parameter names, return types)
   - Extract config/env var claims
   - Mark version claims as "version claim - not verified" (per CONTEXT.md)
   - Use conservative extraction (only backticked items to minimize false positives)

3. **verify_claims** - Check each claim against codebase
   - Use verification strategies from RESEARCH.md Pattern 2:
     - File path: `test -f "$path"`
     - Directory: `test -d "$path" && ls "$path"`
     - Function/class: `grep -E "function $name|class $name|const $name" "$path"`
     - Export: `grep -E "export (default |)(function|const|class) $name" "$path"`
   - Location match requirement: function must be in specific file if location mentioned
   - Reuse patterns from verification-patterns.md directly

4. **score_claims** - Assign confidence levels
   - HIGH: Claim fully verified (file exists, content matches)
   - MEDIUM: Partial verification (exists but different location, version claims)
   - LOW: Verification failed (missing, not found, contradicted)
   - Track claim text and score for each claim

5. **present_issues** - Show LOW confidence claims to user
   - Only show problems (per CONTEXT.md: "Only show problems to user")
   - Show all issues at once using AskUserQuestion with multiSelect=true
   - Format: "[Claim text] (LOW - reason)"
   - If no issues: Skip prompt, show summary only

6. **collect_decisions** - Get user choices
   - Options: Include / Exclude / Mark as "known stale"
   - Record decision for each issue
   - If clean pass (no issues): Skip this step

7. **update_documents** - Annotate USER-CONTEXT.md
   - Add validation status to each document section
   - Include validation date, claim counts, confidence breakdown
   - Mark user decisions on stale/excluded items
   - Preserve original document content

**Return format (to orchestrator):**
```
## VALIDATION COMPLETE

**Documents validated:** [N]
**Total claims:** [N]
**Verified (HIGH):** [N]
**Verified (MEDIUM):** [N]
**Issues (LOW):** [N]

**User decisions:**
- Included as stale: [N]
- Excluded: [N]

**Output:** `.planning/codebase/USER-CONTEXT.md` (annotated)

Ready for downstream integration.
```

**Critical rules to include:**
- DO NOT auto-exclude on failure (user decides)
- Focus on technical claims with verifiable identifiers
- Mark prose/architectural descriptions as MEDIUM if can't verify literally
- Process in batches if USER-CONTEXT.md is large (avoid context exhaustion)
- Note version claims as unverified rather than checking deps

**Templates to include:**
- USER-CONTEXT.md annotation format (add validation frontmatter per section)
- Issue presentation format for AskUserQuestion
- Confirmation return template

Reference gsd-verifier.md for stub detection patterns and gsd-doc-ingestor.md for file structure conventions.
  </action>
  <verify>
    - File exists: `test -f agents/gsd-doc-validator.md`
    - Has frontmatter: `grep -q "^---" agents/gsd-doc-validator.md`
    - Has role section: `grep -q "<role>" agents/gsd-doc-validator.md`
    - Has process section: `grep -q "<process>" agents/gsd-doc-validator.md`
    - Has all 7 steps: `grep -c "step name=" agents/gsd-doc-validator.md` returns 7
    - Has verification patterns: `grep -q "test -f" agents/gsd-doc-validator.md`
    - Has AskUserQuestion usage: `grep -q "AskUserQuestion" agents/gsd-doc-validator.md`
    - Has success criteria: `grep -q "success_criteria" agents/gsd-doc-validator.md`
    - Line count adequate: `wc -l < agents/gsd-doc-validator.md` returns 250+
  </verify>
  <done>gsd-doc-validator agent exists with complete 7-step validation process, claim extraction patterns, verification commands, confidence scoring, user decision collection via AskUserQuestion, and USER-CONTEXT.md annotation format</done>
</task>

</tasks>

<verification>
- [ ] Agent file exists at agents/gsd-doc-validator.md
- [ ] Agent has proper frontmatter (name, description, tools, color)
- [ ] Agent has complete 7-step process matching RESEARCH.md
- [ ] Claim extraction covers all types from CONTEXT.md
- [ ] Verification uses patterns from verification-patterns.md
- [ ] Confidence scoring follows HIGH/MEDIUM/LOW scheme
- [ ] Issue presentation uses AskUserQuestion with multiSelect
- [ ] User choices (Include/Exclude/Stale) are handled
- [ ] Return format matches confirmation template
- [ ] Critical rules documented (no auto-exclude, version handling, prose handling)
</verification>

<success_criteria>
- gsd-doc-validator.md exists with 250+ lines
- All 7 process steps implemented with clear instructions
- Verification patterns copied from reference (not reinvented)
- AskUserQuestion format for issue presentation documented
- Agent can be spawned by Task tool with subagent_type: gsd-doc-validator
</success_criteria>

<output>
After completion, create `.planning/phases/02-document-validation/02-01-SUMMARY.md`
</output>
