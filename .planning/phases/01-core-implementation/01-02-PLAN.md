---
phase: 01-core-implementation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "getDirName('cursor') returns '.cursor'"
    - "getGlobalDir('cursor') returns ~/.cursor/ with CURSOR_CONFIG_DIR env var support"
    - "--cursor CLI flag is recognized and adds 'cursor' to selectedRuntimes"
    - "Cursor appears as option 4 in interactive promptRuntime()"
    - "install(isGlobal, 'cursor') deploys files using nested directory structure"
    - "uninstall(isGlobal, 'cursor') removes GSD files correctly"
    - "getCommitAttribution('cursor') reads from settings.json"
  artifacts:
    - path: "bin/install.js"
      provides: "Complete Cursor runtime support"
      contains: "runtime === 'cursor'"
  key_links:
    - from: "install()"
      to: "convertClaudeToCursorFrontmatter"
      via: "content conversion during file copy"
      pattern: "convertClaudeToCursorFrontmatter\\("
    - from: "getGlobalDir()"
      to: "CURSOR_CONFIG_DIR"
      via: "environment variable support"
      pattern: "CURSOR_CONFIG_DIR"
    - from: "--cursor flag"
      to: "selectedRuntimes"
      via: "argument parsing"
      pattern: "hasCursor.*selectedRuntimes"
---

<objective>
Integrate Cursor runtime support into the installer, wiring up directory handling, CLI flags, and install/uninstall logic.

Purpose: This plan connects the conversion functions from Plan 01 to the installer's runtime system, making Cursor a fully supported runtime alongside Claude, OpenCode, and Gemini.

Output: Complete Cursor runtime support in bin/install.js:
1. Directory handling (`getDirName`, `getGlobalDir`)
2. CLI flag parsing (`--cursor`)
3. Interactive prompt option
4. Install and uninstall logic
5. Attribution handling
</objective>

<execution_context>
@~/.cursor/get-shit-done/workflows/execute-plan.md
@~/.cursor/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/research/FEATURES.md
@.planning/phases/01-core-implementation/01-01-SUMMARY.md
@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CLI flag parsing and directory handling</name>
  <files>bin/install.js</files>
  <action>
**1. Add --cursor flag detection (around line 24, after hasGemini):**
```javascript
const hasCursor = args.includes('--cursor');
```

**2. Update selectedRuntimes logic (around lines 31-39):**
Update the `hasAll` condition and add cursor to the selection:
```javascript
if (hasAll) {
  selectedRuntimes = ['claude', 'opencode', 'gemini', 'cursor'];
} else if (hasBoth) {
  selectedRuntimes = ['claude', 'opencode'];
} else {
  if (hasOpencode) selectedRuntimes.push('opencode');
  if (hasClaude) selectedRuntimes.push('claude');
  if (hasGemini) selectedRuntimes.push('gemini');
  if (hasCursor) selectedRuntimes.push('cursor');
}
```

**3. Update getDirName() function (around line 42-46):**
Add Cursor case:
```javascript
function getDirName(runtime) {
  if (runtime === 'opencode') return '.opencode';
  if (runtime === 'gemini') return '.gemini';
  if (runtime === 'cursor') return '.cursor';
  return '.claude';
}
```

**4. Update getGlobalDir() function (around line 78-106):**
Add Cursor case after the Gemini case:
```javascript
if (runtime === 'cursor') {
  // Cursor: --config-dir > CURSOR_CONFIG_DIR > ~/.cursor
  if (explicitDir) {
    return expandTilde(explicitDir);
  }
  if (process.env.CURSOR_CONFIG_DIR) {
    return expandTilde(process.env.CURSOR_CONFIG_DIR);
  }
  return path.join(os.homedir(), '.cursor');
}
```

**5. Update banner text (around line 108-118):**
Add "Cursor" to the list of supported runtimes:
```javascript
'  A meta-prompting, context engineering and spec-driven\n' +
'  development system for Claude Code, OpenCode, Gemini, and Cursor by TÃ‚CHES.\n';
```
  </action>
  <verify>
Run `node -c bin/install.js` to verify syntax.
Run `node bin/install.js --help` and verify `--cursor` is NOT yet in help (help text is Task 2).
Verify getDirName and getGlobalDir are updated by searching for 'cursor' in those functions.
  </verify>
  <done>
- `hasCursor` flag detection added
- `selectedRuntimes` includes cursor when `--all` or `--cursor` is passed
- `getDirName('cursor')` returns `.cursor`
- `getGlobalDir('cursor')` returns `~/.cursor/` with `CURSOR_CONFIG_DIR` env var support
- Banner text updated to include Cursor
- PATH-01 and PATH-02 requirements implemented
- INST-01 requirement implemented (flag parsing)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update install/uninstall logic and runtime labels</name>
  <files>bin/install.js</files>
  <action>
**1. Update getCommitAttribution() function (around line 205-241):**
Add Cursor case after the Gemini case (Cursor uses same settings.json pattern as Claude/Gemini):
```javascript
} else if (runtime === 'cursor') {
  // Cursor: check settings.json for attribution config (same pattern as Claude Code)
  const settings = readSettings(path.join(getGlobalDir('cursor', explicitDir), 'settings.json'));
  if (!settings.attribution || settings.attribution.commit === undefined) {
    result = undefined;
  } else if (settings.attribution.commit === '') {
    result = null;
  } else {
    result = settings.attribution.commit;
  }
}
```

**2. Update uninstall() function (around line 774-966):**
Add runtime label for Cursor and ensure nested directory structure is used.

Find the runtime label section and add:
```javascript
if (runtime === 'cursor') runtimeLabel = 'Cursor';
```

The uninstall function already handles nested `commands/gsd/` structure for non-OpenCode runtimes, so no structural changes needed.

**3. Update install() function (around line 1069-1279):**
Add Cursor-specific handling:

a. Add isCursor flag at the start of the function:
```javascript
const isCursor = runtime === 'cursor';
```

b. Add runtime label for Cursor:
```javascript
if (isCursor) runtimeLabel = 'Cursor';
```

c. Update the command copying section - Cursor uses nested structure like Claude/Gemini.
Find the section that handles non-OpenCode runtimes (commands/ with nested gsd/) and add Cursor conversion.
After `copyWithPathReplacement(gsdSrc, gsdDest, pathPrefix, runtime);` for the nested structure case,
add handling that calls `convertClaudeToCursorFrontmatter` for Cursor.

**Important:** The `copyWithPathReplacement()` function needs to be updated to handle Cursor runtime.
Find this function (around line 648-691) and add Cursor handling after the Gemini case:

```javascript
} else if (runtime === 'cursor') {
  content = convertClaudeToCursorFrontmatter(content);
  fs.writeFileSync(destPath, content);
}
```

**4. Update agent copying section in install() (around line 1145-1182):**
Add Cursor conversion for agents:
```javascript
} else if (isCursor) {
  content = convertClaudeToCursorFrontmatter(content);
}
```

**5. Update finishInstall() function (around line 1284-1313):**
Add Cursor to the program label:
```javascript
if (runtime === 'cursor') program = 'Cursor';
```

And update the command format for Cursor (uses /gsd- like OpenCode):
```javascript
const command = (isOpencode || runtime === 'cursor') ? '/gsd-help' : '/gsd:help';
```

**6. Update promptRuntime() function (around line 1369-1405):**
Add Cursor as option 4, move All to option 5:
```javascript
console.log(`  ${yellow}Which runtime(s) would you like to install for?${reset}\n\n  ${cyan}1${reset}) Claude Code ${dim}(~/.claude)${reset}
  ${cyan}2${reset}) OpenCode    ${dim}(~/.config/opencode)${reset} - open source, free models
  ${cyan}3${reset}) Gemini      ${dim}(~/.gemini)${reset}
  ${cyan}4${reset}) Cursor      ${dim}(~/.cursor)${reset}
  ${cyan}5${reset}) All
`);

rl.question(`  Choice ${dim}[1]${reset}: `, (answer) => {
  answered = true;
  rl.close();
  const choice = answer.trim() || '1';
  if (choice === '5') {
    callback(['claude', 'opencode', 'gemini', 'cursor']);
  } else if (choice === '4') {
    callback(['cursor']);
  } else if (choice === '3') {
    callback(['gemini']);
  } else if (choice === '2') {
    callback(['opencode']);
  } else {
    callback(['claude']);
  }
});
```

**7. Update help text (around line 151-153):**
Add `--cursor` flag to help output after `--gemini`:
```javascript
${cyan}--cursor${reset}                  Install for Cursor only
```

And add example:
```javascript
${dim}# Install for Cursor globally${reset}
npx get-shit-done-cc --cursor --global
```

**8. Update installAllRuntimes() function (around line 1454-1492):**
Add Cursor to the statusline handling (Cursor supports hooks like Claude/Gemini):
```javascript
const cursorResult = results.find(r => r.runtime === 'cursor');
```

And include it in the statusline prompt logic:
```javascript
if (claudeResult || geminiResult || cursorResult) {
  const primaryResult = claudeResult || geminiResult || cursorResult;
  // ... existing logic ...
  if (cursorResult) {
    finishInstall(cursorResult.settingsPath, cursorResult.settings, cursorResult.statuslineCommand, shouldInstallStatusline, 'cursor');
  }
}
```
  </action>
  <verify>
Run `node -c bin/install.js` to verify syntax.
Run `node bin/install.js --help` and verify:
- `--cursor` flag is documented
- Cursor example is shown

Test dry-run (don't actually install):
```bash
# Should parse without error and show Cursor in the prompt
node bin/install.js --cursor --global --help
```
  </verify>
  <done>
- INST-02: Cursor option (4) in interactive promptRuntime()
- INST-03: install(isGlobal, 'cursor') deploys files to ~/.cursor/ using nested commands/gsd/ structure
- INST-04: uninstall(isGlobal, 'cursor') removes GSD files correctly
- INST-05: getCommitAttribution('cursor') reads from settings.json
- Help text includes --cursor flag and examples
- finishInstall() shows Cursor-appropriate completion message
- Runtime labels and command format (/gsd-help) correct for Cursor
  </done>
</task>

</tasks>

<verification>
1. `node -c bin/install.js` passes (no syntax errors)
2. `node bin/install.js --help` shows `--cursor` flag and example
3. getDirName('cursor') returns '.cursor'
4. getGlobalDir('cursor') returns path to ~/.cursor/
5. promptRuntime() shows Cursor as option 4
6. All runtime paths use nested commands/gsd/ structure for Cursor (not flat)
</verification>

<success_criteria>
- [ ] `--cursor` CLI flag recognized (INST-01)
- [ ] Cursor option in interactive prompt as option 4 (INST-02)
- [ ] `install(isGlobal, 'cursor')` works with nested directory structure (INST-03)
- [ ] `uninstall(isGlobal, 'cursor')` removes files correctly (INST-04)
- [ ] `getCommitAttribution('cursor')` reads from settings.json (INST-05)
- [ ] `getDirName('cursor')` returns `.cursor` (PATH-01)
- [ ] `getGlobalDir('cursor')` supports CURSOR_CONFIG_DIR env var (PATH-02)
- [ ] Path and command format conversion happens via convertClaudeToCursorFrontmatter (PATH-03, PATH-04)
- [ ] `node -c bin/install.js` passes without errors
- [ ] Help text includes --cursor flag and Cursor example
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-implementation/01-02-SUMMARY.md`
</output>
