---
phase: 06-multi-stack-analyzer
plan: 05
type: execute
wave: 3
depends_on: ["06-03"]
files_modified:
  - get-shit-done/templates/entity.md
  - agents/gsd-entity-generator.md
autonomous: true

must_haves:
  truths:
    - "Entity template includes stack and framework frontmatter fields"
    - "Entity generator subagent documents stack field usage"
    - "Type heuristics table includes stack-specific guidance"
    - "Example entity shows stack field in frontmatter"
  artifacts:
    - path: "get-shit-done/templates/entity.md"
      provides: "Updated entity template with stack fields"
      contains: "stack"
    - path: "agents/gsd-entity-generator.md"
      provides: "Updated entity generator with stack awareness"
      contains: "stack"
  key_links:
    - from: "get-shit-done/templates/entity.md"
      to: "hooks/gsd-intel-index.js"
      via: "Frontmatter parsed by hook"
      pattern: "parseEntityFrontmatter"
---

# Plan 06-05: Entity Template Update

<objective>
Update the entity template and entity generator subagent to include stack and framework fields. This enables filtering entities by programming language in graph queries.

Purpose: When entities have stack metadata, users can query "show all Python models" or "find TypeScript components." This completes the multi-stack intelligence chain from detection to entity generation.

Output:
- Updated `get-shit-done/templates/entity.md` (~30 lines added)
- Updated `agents/gsd-entity-generator.md` (~20 lines added)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-multi-stack-analyzer/06-RESEARCH.md
@get-shit-done/templates/entity.md
@agents/gsd-entity-generator.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update entity template with stack fields</name>
  <files>get-shit-done/templates/entity.md</files>
  <action>
Update the entity template to include `stack` and `framework` frontmatter fields.

**Update the File Template section:**
Change the frontmatter from:
```markdown
---
path: {path}
type: {type}
updated: {updated}
status: {status}
---
```

To:
```markdown
---
path: {path}
type: {type}
stack: {stack}
framework: {framework}
updated: {updated}
status: {status}
---
```

**Update the Field Reference table:**
Add new rows:
```markdown
| `stack` | javascript, typescript, python, csharp, go, rust, java, etc. | Programming language stack |
| `framework` | react, django, aspnetcore, spring, etc. (optional) | Framework if detected |
```

**Update the Example:**
Change the example frontmatter to include:
```markdown
---
path: /project/src/lib/auth.ts
type: util
stack: typescript
framework: nextjs
updated: 2025-01-15
status: active
---
```

**Add guidance section:**
```markdown
### Stack and Framework

The `stack` field identifies the programming language:
- Derived from file extension and surrounding context
- Values match stack IDs from `hooks/lib/stack-profiles.yaml`
- Examples: `javascript`, `typescript`, `python`, `csharp`, `go`, `rust`

The `framework` field is optional:
- Only included when a specific framework is detected
- Examples: `react`, `nextjs`, `django`, `flask`, `aspnetcore`, `spring`
- Omit if no framework detected (don't use "none" or "unknown")

**Why this matters:**
- Enables queries like "find all Python models"
- Allows filtering entities by language in polyglot codebases
- Framework field helps understand conventions in use
```
  </action>
  <verify>
```bash
# Check stack field in template
grep -n "stack:" get-shit-done/templates/entity.md

# Verify framework field
grep -n "framework:" get-shit-done/templates/entity.md

# Check field reference table has new rows
grep -A 2 "stack" get-shit-done/templates/entity.md | head -10
```
  </verify>
  <done>entity.md template updated with stack and framework frontmatter fields</done>
</task>

<task type="auto">
  <name>Task 2: Update gsd-entity-generator for stack awareness</name>
  <files>agents/gsd-entity-generator.md</files>
  <action>
Update the entity generator subagent to include stack and framework fields when generating entities.

**Update the entity template in the subagent (around line 127-135):**
Add stack and framework to the frontmatter:
```markdown
---
path: {absolute_path}
type: [module|component|util|config|api|hook|service|model|test]
stack: {stack_id}
framework: {framework_id}
updated: {YYYY-MM-DD}
status: active
---
```

**Update the process section (Step 2):**
Add stack detection to file analysis:
```markdown
2. **Analyze the file:**
   - What is its purpose? (Why does this file exist? What problem does it solve?)
   - What does it export? (Functions, classes, types, constants)
   - What does it import? (Dependencies and why they're needed)
   - What type of module is it? (Use type heuristics table)
   - **What stack is it?** (Use extension: .ts/.tsx -> typescript, .py -> python, .cs -> csharp, etc.)
   - **What framework?** (Look for imports: react, django, express, etc.)
```

**Add stack detection guidance:**
```markdown
### Stack Detection from File

Determine stack from file extension:
| Extension | Stack |
|-----------|-------|
| .js, .mjs, .cjs | javascript |
| .ts, .tsx | typescript |
| .py | python |
| .cs | csharp |
| .go | go |
| .rs | rust |
| .java | java |
| .kt | kotlin |
| .rb | ruby |
| .php | php |
| .swift | swift |
| .ps1 | powershell |

### Framework Detection from Imports

Look for framework-specific imports:
- `import React` or `from 'react'` -> react
- `from django` or `import django` -> django
- `from flask` -> flask
- `from fastapi` -> fastapi
- `using Microsoft.AspNetCore` -> aspnetcore
- `import express` -> express
- `@nestjs` imports -> nestjs
- `from next` -> nextjs

If no framework detected, omit the framework field entirely (don't set to null or "none").
```

**Update critical rules:**
Add to the critical rules section:
```markdown
**INCLUDE STACK FIELD.** Every entity must have a stack field based on file extension.

**FRAMEWORK IS OPTIONAL.** Only include framework field if framework-specific imports detected.
```
  </action>
  <verify>
```bash
# Check stack field in entity generator
grep -n "stack:" agents/gsd-entity-generator.md

# Verify framework guidance
grep -n "framework" agents/gsd-entity-generator.md

# Check extension table
grep -A 15 "Extension" agents/gsd-entity-generator.md | head -20
```
  </verify>
  <done>gsd-entity-generator.md updated with stack and framework detection guidance</done>
</task>

</tasks>

<verification>
- [ ] `get-shit-done/templates/entity.md` has stack and framework in frontmatter
- [ ] Template field reference documents new fields
- [ ] Example entity shows stack and framework usage
- [ ] `agents/gsd-entity-generator.md` includes stack detection from extension
- [ ] Framework detection from imports documented
- [ ] Critical rules mention stack field requirement
</verification>

<success_criteria>
- Entity template frontmatter has: path, type, stack, framework, updated, status
- Field reference documents allowed values for stack (matches stack-profiles.yaml IDs)
- Framework field documented as optional (only when detected)
- Entity generator subagent knows how to determine stack from extension
- Entity generator subagent can detect common frameworks from imports
</success_criteria>

<output>
After completion, create `.planning/phases/06-multi-stack-analyzer/06-05-SUMMARY.md`
</output>
