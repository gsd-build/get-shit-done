---
phase: 08.1-telegram-mcp-server
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp-servers/telegram-mcp/package.json
  - mcp-servers/telegram-mcp/tsconfig.json
  - mcp-servers/telegram-mcp/src/index.ts
autonomous: true

must_haves:
  truths:
    - "MCP server starts via stdio transport (stdin/stdout JSON-RPC)"
    - "Server lists tools and resources on initialize"
    - "Server responds to list_tools and list_resources requests"
  artifacts:
    - path: "mcp-servers/telegram-mcp/package.json"
      provides: "MCP SDK dependencies and build scripts"
      contains: "@modelcontextprotocol/sdk"
    - path: "mcp-servers/telegram-mcp/src/index.ts"
      provides: "MCP server entry point with stdio transport"
      exports: ["main"]
      min_lines: 80
  key_links:
    - from: "mcp-servers/telegram-mcp/src/index.ts"
      to: "@modelcontextprotocol/sdk"
      via: "import Server, StdioServerTransport"
      pattern: "new Server.*StdioServerTransport"
---

<objective>
Create MCP server foundation with stdio transport, tool/resource registration, and TypeScript build infrastructure.

Purpose: Establish the core MCP server that will auto-load with Claude Code and communicate via JSON-RPC over stdin/stdout.

Output: Working MCP server skeleton that responds to initialize, list_tools, and list_resources.
</objective>

<execution_context>
@/Users/ollorin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ollorin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08.1-telegram-mcp-server-replace-standalone-bot-with-mcp-integration-using-subscription-tokens/08.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MCP server project structure with dependencies</name>
  <files>
    mcp-servers/telegram-mcp/package.json
    mcp-servers/telegram-mcp/tsconfig.json
  </files>
  <action>
Create the MCP server project directory and configuration:

1. Create `mcp-servers/telegram-mcp/package.json`:
```json
{
  "name": "telegram-mcp",
  "version": "1.0.0",
  "description": "MCP server for Telegram integration with GSD",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0"
  }
}
```

2. Create `mcp-servers/telegram-mcp/tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

3. Run `npm install` in the mcp-servers/telegram-mcp directory.
  </action>
  <verify>
Run `ls mcp-servers/telegram-mcp/node_modules/@modelcontextprotocol` to confirm SDK installed.
  </verify>
  <done>
package.json and tsconfig.json exist, npm install completed, MCP SDK in node_modules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MCP server entry point with stdio transport</name>
  <files>mcp-servers/telegram-mcp/src/index.ts</files>
  <action>
Create the MCP server entry point that:

1. Imports MCP SDK Server and StdioServerTransport
2. Creates server instance with name "telegram-mcp" and version "1.0.0"
3. Registers placeholder tool handlers (to be implemented in later plans):
   - `ask_blocking_question` - Send question to user via Telegram
   - `check_question_answers` - Poll for answers to pending questions
   - `mark_question_answered` - Archive answered question
4. Registers placeholder resource handler:
   - `telegram://requirements/new` - JSONL stream of new requirements
5. Connects to stdio transport (stdin/stdout JSON-RPC)
6. Handles graceful shutdown on SIGINT/SIGTERM

Follow MCP SDK patterns from the spec:
```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import {
  ListToolsRequestSchema,
  CallToolRequestSchema,
  ListResourcesRequestSchema,
  ReadResourceRequestSchema
} from "@modelcontextprotocol/sdk/types.js";
```

Tool definitions should include:
- name, description, inputSchema (JSON Schema for parameters)

Resource definitions should include:
- uri, name, description, mimeType
  </action>
  <verify>
Run `cd mcp-servers/telegram-mcp && npm run build` to verify TypeScript compiles without errors.
  </verify>
  <done>
src/index.ts exists, TypeScript compiles to dist/index.js, server defines 3 tools and 1 resource.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify MCP server responds to protocol requests</name>
  <files>mcp-servers/telegram-mcp/src/index.ts</files>
  <action>
Test the MCP server responds correctly:

1. Run the server: `node mcp-servers/telegram-mcp/dist/index.js`
2. Send a `{"jsonrpc":"2.0","method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test"}},"id":1}` via stdin
3. Verify server responds with capabilities including tools and resources
4. Send `{"jsonrpc":"2.0","method":"tools/list","params":{},"id":2}`
5. Verify response includes the 3 tool definitions
6. Send `{"jsonrpc":"2.0","method":"resources/list","params":{},"id":3}`
7. Verify response includes telegram://requirements/new resource

Add error handling for malformed requests. Log to stderr only (stdout reserved for JSON-RPC).
  </action>
  <verify>
Run verification by piping JSON-RPC requests:
```bash
echo '{"jsonrpc":"2.0","method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test"}},"id":1}' | node mcp-servers/telegram-mcp/dist/index.js 2>/dev/null | head -1 | jq -r '.result.serverInfo.name'
```
Should output: telegram-mcp
  </verify>
  <done>
MCP server responds to initialize with serverInfo, tools/list returns 3 tools, resources/list returns 1 resource.
  </done>
</task>

</tasks>

<verification>
- [ ] MCP server project structure exists at mcp-servers/telegram-mcp/
- [ ] TypeScript compiles without errors
- [ ] Server responds to JSON-RPC initialize request
- [ ] tools/list returns ask_blocking_question, check_question_answers, mark_question_answered
- [ ] resources/list returns telegram://requirements/new
</verification>

<success_criteria>
MCP server skeleton is functional: starts via stdio, lists tools and resources, ready for tool implementation in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-telegram-mcp-server-replace-standalone-bot-with-mcp-integration-using-subscription-tokens/08.1-01-SUMMARY.md`
</output>
