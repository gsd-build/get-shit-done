---
phase: 01-constitution-foundation
plan: 01
type: tdd
wave: 1
depends_on: []
checkpoint: after_each_task
files_modified:
  - ~/.claude/get-shit-done/templates/constitution/global-constitution.md
  - ~/.claude/get-shit-done/templates/constitution/project-constitution.md
  - get-shit-done/templates/constitution/global-constitution.md
  - get-shit-done/templates/constitution/project-constitution.md
  - tests/constitution/templates.test.js
autonomous: true

must_haves:
  truths:
    - "Global CONSTITUTION.md template exists with severity sections"
    - "Project CONSTITUTION.md template exists for overrides"
    - "TDD-01 rule documented with examples"
    - "Security rules SEC-01 through SEC-07 documented"
    - "Tests validate template structure before templates created"
  artifacts:
    - path: "tests/constitution/templates.test.js"
      provides: "Template validation tests"
      contains: "describe('Constitution Templates'"
      min_lines: 80
    - path: "get-shit-done/templates/constitution/global-constitution.md"
      provides: "Global constitution template"
      contains: "# NON-NEGOTIABLE"
      min_lines: 200
    - path: "get-shit-done/templates/constitution/project-constitution.md"
      provides: "Project constitution template"
      contains: "version:"
      min_lines: 30
  key_links:
    - from: "tests/constitution/templates.test.js"
      to: "template files"
      via: "fs.readFileSync validation"
      pattern: "readFileSync.*constitution"
---

<objective>
Create constitution templates using TDD. Tests first define expected structure, then templates satisfy tests.

Purpose: Establish constitutional format. TDD ensures templates meet requirements before creation.
Output: Validated constitution templates in GSD install and repo source.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md

**TDD-FIRST (MANDATORY):**
1. RED: Write tests defining template requirements
2. GREEN: Create templates that pass tests
3. Copy validated templates to repo source

**Security Severity (from OWASP research):**
- SEC-01, SEC-02 = CRITICAL (NON-NEGOTIABLE) - Injection, secrets exposure
- SEC-03, SEC-04, SEC-05 = HIGH (ERROR) - Input validation, XSS, auth
- SEC-06, SEC-07 = MEDIUM (WARNING) - Dependencies, data exposure
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-constitution-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write template validation tests (RED)</name>
  <files>tests/constitution/templates.test.js</files>
  <action>
Create tests defining expected template structure BEFORE creating templates.

```javascript
// tests/constitution/templates.test.js
const fs = require('fs');
const path = require('path');

const GLOBAL_PATH = path.join(process.env.HOME, '.claude', 'get-shit-done', 'templates', 'constitution', 'global-constitution.md');
const PROJECT_PATH = path.join(process.env.HOME, '.claude', 'get-shit-done', 'templates', 'constitution', 'project-constitution.md');

describe('Constitution Templates', () => {
  describe('Global Constitution', () => {
    let content;

    beforeAll(() => {
      content = fs.readFileSync(GLOBAL_PATH, 'utf8');
    });

    test('has YAML frontmatter with quoted version', () => {
      expect(content).toMatch(/^---\n/);
      expect(content).toMatch(/version: "1\.0\.0"/);
    });

    test('has three severity sections', () => {
      expect(content).toContain('# NON-NEGOTIABLE');
      expect(content).toContain('# ERROR');
      expect(content).toContain('# WARNING');
    });

    test('has TDD-01 rule in NON-NEGOTIABLE', () => {
      const nonNegSection = content.split('# NON-NEGOTIABLE')[1].split('# ERROR')[0];
      expect(nonNegSection).toContain('### TDD-01:');
      expect(nonNegSection).toContain('## Good Example');
      expect(nonNegSection).toContain('## Bad Example');
    });

    test('has SEC-01 and SEC-02 in NON-NEGOTIABLE (CRITICAL)', () => {
      const nonNegSection = content.split('# NON-NEGOTIABLE')[1].split('# ERROR')[0];
      expect(nonNegSection).toContain('### SEC-01:');
      expect(nonNegSection).toContain('### SEC-02:');
    });

    test('has SEC-03, SEC-04, SEC-05 in ERROR (HIGH)', () => {
      const errorSection = content.split('# ERROR')[1].split('# WARNING')[0];
      expect(errorSection).toContain('### SEC-03:');
      expect(errorSection).toContain('### SEC-04:');
      expect(errorSection).toContain('### SEC-05:');
    });

    test('has SEC-06, SEC-07 in WARNING (MEDIUM)', () => {
      const warnSection = content.split('# WARNING')[1];
      expect(warnSection).toContain('### SEC-06:');
      expect(warnSection).toContain('### SEC-07:');
    });

    test('each rule has rationale', () => {
      const rules = ['TDD-01', 'SEC-01', 'SEC-02', 'SEC-03', 'SEC-04', 'SEC-05', 'SEC-06', 'SEC-07'];
      rules.forEach(rule => {
        const ruleSection = content.split(`### ${rule}:`)[1]?.split('###')[0] || '';
        expect(ruleSection).toContain('**Rationale:**');
      });
    });

    test('minimum 200 lines', () => {
      const lines = content.split('\n').length;
      expect(lines).toBeGreaterThanOrEqual(200);
    });
  });

  describe('Project Constitution', () => {
    let content;

    beforeAll(() => {
      content = fs.readFileSync(PROJECT_PATH, 'utf8');
    });

    test('has YAML frontmatter with quoted version', () => {
      expect(content).toMatch(/^---\n/);
      expect(content).toMatch(/version: "1\.0\.0"/);
    });

    test('has three severity sections', () => {
      expect(content).toContain('# NON-NEGOTIABLE');
      expect(content).toContain('# ERROR');
      expect(content).toContain('# WARNING');
    });

    test('explains override precedence', () => {
      expect(content).toMatch(/override|extend/i);
    });

    test('minimum 30 lines', () => {
      const lines = content.split('\n').length;
      expect(lines).toBeGreaterThanOrEqual(30);
    });
  });
});
```

mkdir -p tests/constitution
  </action>
  <verify>
`npm test -- templates.test.js` runs and FAILS (RED phase).
Tests define requirements for templates that don't exist yet.
  </verify>
  <done>
Template validation tests written. Tests FAIL because templates don't exist.
RED phase complete.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create templates that pass tests (GREEN)</name>
  <files>
    ~/.claude/get-shit-done/templates/constitution/global-constitution.md
    ~/.claude/get-shit-done/templates/constitution/project-constitution.md
  </files>
  <action>
Create templates in GSD install that satisfy all tests.

**Global template structure:**
```markdown
---
version: "1.0.0"
lastUpdated: "YYYY-MM-DD"
---

# Constitution

[Brief intro]

# NON-NEGOTIABLE

### TDD-01: Test before implementation
[Description]
**Rationale:** [Why]
## Good Example
[code]
## Bad Example
[code]

### SEC-01: No hardcoded secrets
[OWASP pattern: process.env vs hardcoded]
**Rationale:** [CRITICAL - secrets exposure]

### SEC-02: Parameterized queries only
[OWASP pattern: parameterized vs concat]
**Rationale:** [CRITICAL - SQL injection]

# ERROR

### SEC-03: Input validation required
**Rationale:** [HIGH - untrusted input]

### SEC-04: Output sanitization required
**Rationale:** [HIGH - XSS prevention]

### SEC-05: Authentication/authorization checks
**Rationale:** [HIGH - access control]

# WARNING

### SEC-06: Secure dependency management
**Rationale:** [MEDIUM - supply chain]

### SEC-07: No sensitive data exposure
**Rationale:** [MEDIUM - info leakage]
```

mkdir -p ~/.claude/get-shit-done/templates/constitution
  </action>
  <verify>
`npm test -- templates.test.js` PASSES (GREEN phase).
All template structure requirements satisfied.
  </verify>
  <done>
Templates created and tests pass. GREEN phase complete.
  </done>
</task>

<task type="auto">
  <name>Task 3: Copy to repo source</name>
  <files>
    get-shit-done/templates/constitution/global-constitution.md
    get-shit-done/templates/constitution/project-constitution.md
  </files>
  <action>
```bash
mkdir -p get-shit-done/templates/constitution
cp ~/.claude/get-shit-done/templates/constitution/global-constitution.md get-shit-done/templates/constitution/
cp ~/.claude/get-shit-done/templates/constitution/project-constitution.md get-shit-done/templates/constitution/
diff ~/.claude/get-shit-done/templates/constitution/global-constitution.md get-shit-done/templates/constitution/global-constitution.md
```
  </action>
  <verify>
Files exist in repo. Diff shows no differences.
  </verify>
  <done>
Templates in repo source, matching GSD install.
  </done>
</task>

</tasks>

<verification>
- `npm test -- templates.test.js` passes
- Global: >= 200 lines, 3 severity sections, TDD-01 + SEC-01-07 with rationale
- Project: >= 30 lines, override explanation
- Repo files match GSD install files
</verification>

<success_criteria>
- [ ] Tests written FIRST (RED)
- [ ] Tests FAIL before templates exist
- [ ] Templates pass all tests (GREEN)
- [ ] TDD-01 fully documented
- [ ] SEC-01, SEC-02 in NON-NEGOTIABLE (CRITICAL)
- [ ] SEC-03, SEC-04, SEC-05 in ERROR (HIGH)
- [ ] SEC-06, SEC-07 in WARNING (MEDIUM)
- [ ] Copied to repo source
</success_criteria>

<output>
Create `.planning/phases/01-constitution-foundation/01-01-SUMMARY.md`
Update `.planning/STATE.md` with task progress
</output>
