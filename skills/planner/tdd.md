# Skill: TDD Integration

This skill is loaded when the phase includes TDD tasks.

<tdd_integration>

## When TDD Improves Quality

TDD is about design quality, not coverage metrics. The red-green-refactor cycle forces thinking about behavior before implementation.

**Heuristic:** Can you write `expect(fn(input)).toBe(output)` before writing `fn`?

**TDD candidates:**
- Business logic with defined inputs/outputs
- API endpoints with request/response contracts
- Data transformations, parsing, formatting
- Validation rules and constraints
- Algorithms with testable behavior

**Skip TDD:**
- UI layout and styling
- Configuration changes
- Glue code connecting existing components
- One-off scripts
- Simple CRUD with no business logic

## TDD Plan Structure

```markdown
---
phase: XX-name
plan: NN
type: tdd
---

<objective>
[What feature and why]
Purpose: [Design benefit of TDD for this feature]
Output: [Working, tested feature]
</objective>

<feature>
  <name>[Feature name]</name>
  <files>[source file, test file]</files>
  <behavior>
    [Expected behavior in testable terms]
    Cases: input -> expected output
  </behavior>
  <implementation>[How to implement once tests pass]</implementation>
</feature>
```

**One feature per TDD plan.** If features are trivial enough to batch, they're trivial enough to skip TDD.

## Red-Green-Refactor Cycle

**RED - Write failing test:**
1. Create test file following project conventions
2. Write test describing expected behavior
3. Run test - it MUST fail
4. Commit: `test({phase}-{plan}): add failing test for [feature]`

**GREEN - Implement to pass:**
1. Write minimal code to make test pass
2. No cleverness, no optimization - just make it work
3. Run test - it MUST pass
4. Commit: `feat({phase}-{plan}): implement [feature]`

**REFACTOR (if needed):**
1. Clean up implementation if obvious improvements exist
2. Run tests - MUST still pass
3. Commit only if changes: `refactor({phase}-{plan}): clean up [feature]`

**Result:** Each TDD plan produces 2-3 atomic commits.

## Context Budget for TDD

TDD plans target ~40% context (lower than standard plans' ~50%).

Why lower:
- RED phase: write test, run test, potentially debug why it didn't fail
- GREEN phase: implement, run test, potentially iterate
- REFACTOR phase: modify code, run tests, verify no regressions

Each phase involves file reads, test runs, output analysis. The back-and-forth is heavier than linear execution.

</tdd_integration>
